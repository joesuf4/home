Host * !*bastion*
  ControlMaster auto
  ControlPath ~/.ssh/sockets/%r@%h:%p
  ControlPersist 900
  ServerAliveInterval 60
  HashKnownHosts no

# Anything with a "-" in the name will hit this, which is pretty much everything on AWS EC2.
# To avoid this stanza (and thus avoiding SSM), use raw IP addresses on the command line (aka use
# `host` to do hostname -> IP address resolution first).
Host *-* !*bastion*
  ProxyCommand $SHELL -c '. ~/.ec2rc && aws ssm start-session --target ${EC2_ID[%h]} --document-name AWS-StartSSHSession --parameters portNumber=%p'
  ForwardAgent yes
  StrictHostKeyChecking no
  User ssm-user

Host *bastion* 10.*
  IdentitiesOnly yes
  HashKnownHosts no
  User ubuntu
  StrictHostKeyChecking no

Host *sunstarsys.com
  User joe
